---
title: "Dataframe_correction"
author: "Yujia Luan"
date: "2023-07-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(haven)
library(stringr)
library(dplyr)
library(Hmisc)
library(naniar)
library(labelled)
library(ggplot2)
```

```{r}
chdf2005<-subset(SN05HM,hv105<18)

chdf2005<-select(chdf2005,hv001,hv002,hvidx,
                 hv111,hv113,
                 hv110,hv217,hv105,hv104,hv025,hv201,
                 hv205,hv206,hv207,hv208,hv209,hv210,hv211,hv212,hv227,hv221,
                 #education
                 hv106,hv107,
                 #wealth index
                 hv270,
                 #malaria rapid test
                 #hml35,
                 hc1,hc2,hc3,
                 ha1,ha2,ha3)
#chdf2005["hml35"]<-NA
#chdf2005<-subset(chdf2005,is.na(hv111)==FALSE)
colnames(chdf2005)[6]<-"hv121"

```


```{r}
chdf2005["Orphanhood"] <- ifelse(chdf2005$hv111 == 0 | chdf2005$hv113 == 0, 
                                   "orphan", "non-orphan")

#colnames(chdf2005)<-c("cluster number","household number","line number",
#                      "mother alive","father alive",
#                      "school attendence","relationship structure","age","gender","type of #place of residence","source of drinking water",
#                      "type of toilet facility","has electricity","has radio","has #television","has refrigerator","has bicycle","has motorcycle","has car","has bednet","has #phone")
```


```{r}
#clean the data
chdf2005<-replace_with_na(chdf2005,replace=list(hv111 = c(8,9),
                                      hv113 = c(8,9),
                                      hv121 = c(9),
                                      hv201 = c(97,99),
                                      hv104 = 9,
                                      hv205 = 99,
                                      hv206=9,
                                      hv207=9,
                                      hv208=9,
                                      hv209=9,
                                      hv210=9,
                                      hv211=9,
                                      hv212=9,
                                      hv227=9,
                                      hv221=9,
                                      hv106=c(8,9),
                                      hv107=c(98,99),
                                      hv110=9,
                                      hml35=c(6,9),
                                      hc2=c(9994,9995,9996,9999),
                                      hc3=c(9994,9995,9996,9999),
                                      ha2=c(9994,9995,9996,9999),
                                      ha3=c(9994,9995,9996,9999)
                                      ))


```

```{r}
#organise binary data
chdf2005["hv121"] <- ifelse(chdf2005$hv121 == 1 | chdf2005$hv121 == 2, 
                                   1, 0)
chdf2005["hv025"] <- ifelse(chdf2005$hv121 == 1, 
                                   1, 0)
chdf2005["hv270"] <- ifelse(chdf2005$hv270<3,1,0)

```

```{r}
for (x in 1:nrow(chdf2005)){
  if (chdf2005$hv105[x]<5){
    chdf2005$BMI[x]<-(chdf2005$hc2[x]/10)/(chdf2005$hc3[x]/1000)**2
    chdf2005$heightage[x]<-(chdf2005$hc3[x]/1000)/(chdf2005$hc1[x]/12)
    chdf2005$weightage[x]<-(chdf2005$hc2[x]/10)/(chdf2005$hc1[x]/12)
  }
  else{
    chdf2005$BMI[x]<-(chdf2005$hc2[x]/10)/(chdf2005$hc3[x]/1000)**2
    chdf2005$heightage[x]<-(chdf2005$hc3[x]/1000)/(chdf2005$hc1[x])
    chdf2005$weightage[x]<-(chdf2005$hc2[x]/10)/(chdf2005$hc1[x])
  }
}
```

```{r}
#change the label
chdf2005$hv001 <- labelled(chdf2005$hv001, label = "cluster number")
chdf2005$hv270 <- labelled(chdf2005$hv270, label = "Wealth index(poor famiily)")
chdf2005$hv002 <- labelled(chdf2005$hv002, label = "household number")
chdf2005$hvidx <- labelled(chdf2005$hvidx, label = "line number")
#chdf2005$hv110 <- labelled(chdf2005$hv110, label = "school attendence")
chdf2005$hv121 <- labelled(chdf2005$hv121, label = "school attendence")
chdf2005$hv105 <- labelled(chdf2005$hv105, label = "age")
chdf2005$hv104 <- labelled(chdf2005$hv104, label = "gender")
chdf2005$hv025 <- labelled(chdf2005$hv025, label = "rural/urban")
chdf2005$hc1 <- labelled(chdf2005$hc1, label = "age in months(under 5)")
chdf2005$hc2 <- labelled(chdf2005$hc2, label = "weight(under 5)")
chdf2005$hc3 <- labelled(chdf2005$hc3, label = "height(under 5)")
chdf2005$ha1 <- labelled(chdf2005$ha1, label = "age in years(female)")
chdf2005$ha2 <- labelled(chdf2005$ha2, label = "weight(female)")
chdf2005$ha3 <- labelled(chdf2005$ha3, label = "height(female)")
#chdf2005$hml35 <- labelled(chdf2005$hml35, label = "malaria rapid test")
chdf2005$Orphanhood <- labelled(chdf2005$Orphanhood, label = "orphanhood")
```

